version: 2

models:
  - name: int_customers__order_aggregates
    description: >
      Customer-level order behavior aggregates.
      One row per customer with summary statistics of their ordering history.
      Foundation for customer analytics and segmentation.
    columns:
      - name: customer_id
        description: Unique customer identifier (primary key)
        data_tests:
          - unique
          - not_null

      - name: first_order_at
        description: Timestamp of customer's first order

      - name: most_recent_order_at
        description: Timestamp of customer's most recent order

      - name: total_orders
        description: Total number of orders placed by this customer
        data_tests:
          - not_null
          # dbt-utils: Ensure order count is positive
          - dbt_utils.expression_is_true:
              arguments:
                expression: "> 0"
              config:
                severity: error

      - name: total_revenue
        description: Total revenue generated by this customer (sum of all order totals)
        data_tests:
          - not_null
          # dbt-utils: Ensure revenue is non-negative
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">= 0"
              config:
                severity: error

      - name: total_items_purchased
        description: Total number of items purchased across all orders

      - name: avg_order_value
        description: Average order total for this customer

      - name: avg_items_per_order
        description: Average number of items per order

      - name: customer_lifetime_days
        description: Days between first and most recent order
        data_tests:
          - not_null
          # dbt-utils: Ensure lifetime is non-negative
          - dbt_utils.expression_is_true:
              arguments:
                expression: ">= 0"
              config:
                severity: error
