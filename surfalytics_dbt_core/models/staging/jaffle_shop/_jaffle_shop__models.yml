version: 2

models:
  - name: stg_jaffle_shop__customers
    description: >
      Staging model for customer dimension data.
      One row per customer with basic profile information.
    columns:
      - name: customer_id
        description: Unique identifier for each customer (primary key)
        data_tests:
          - unique
          - not_null

      - name: customer_name
        description: Customer full name
        data_tests:
          - not_null

      - name: _loaded_at
        description: Timestamp when this record was loaded into staging

  - name: stg_jaffle_shop__orders
    description: >
      Staging model for order fact table.
      One row per order with customer, store, and financial details.
      Monetary values have been converted from cents to dollars.
    columns:
      - name: order_id
        description: Unique identifier for each order (primary key)
        data_tests:
          - unique
          - not_null

      - name: customer_id
        description: Foreign key to customers
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_jaffle_shop__customers')
              field: customer_id

      - name: store_id
        description: Foreign key to stores
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_jaffle_shop__stores')
              field: store_id

      - name: ordered_at
        description: Timestamp when the order was placed
        data_tests:
          - not_null

      - name: subtotal
        description: Order subtotal in dollars (before tax)
        data_tests:
          - not_null

      - name: tax_paid
        description: Tax amount in dollars
        data_tests:
          - not_null

      - name: order_total
        description: Total order amount in dollars (subtotal + tax)
        data_tests:
          - not_null

      - name: tax_rate
        description: Calculated tax rate (tax_paid / subtotal) for validation

      - name: _loaded_at
        description: Timestamp when this record was loaded into staging

  - name: stg_jaffle_shop__order_items
    description: >
      Staging model for order line items.
      One row per item in an order, representing the product purchased.
    columns:
      - name: order_item_id
        description: Unique identifier for each order item (primary key)
        data_tests:
          - unique
          - not_null

      - name: order_id
        description: Foreign key to orders
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_jaffle_shop__orders')
              field: order_id

      - name: sku
        description: Foreign key to products (product SKU code)
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_jaffle_shop__products')
              field: sku

      - name: _loaded_at
        description: Timestamp when this record was loaded into staging

  - name: stg_jaffle_shop__products
    description: >
      Staging model for product catalog.
      One row per product SKU with pricing and category information.
      Price has been converted from cents to dollars.
    columns:
      - name: sku
        description: Stock keeping unit - unique product identifier (primary key)
        data_tests:
          - unique
          - not_null

      - name: product_name
        description: Product display name
        data_tests:
          - not_null

      - name: type
        description: Product category (Jaffle or Beverage)
        data_tests:
          - not_null
          - accepted_values:
              values: ['Jaffle', 'Beverage']

      - name: price
        description: Product price in dollars
        data_tests:
          - not_null

      - name: description
        description: Product description text

      - name: _loaded_at
        description: Timestamp when this record was loaded into staging

  - name: stg_jaffle_shop__stores
    description: >
      Staging model for store location dimension.
      One row per store with location details and tax rate.
    columns:
      - name: store_id
        description: Unique identifier for each store (primary key)
        data_tests:
          - unique
          - not_null

      - name: store_name
        description: Store location name (city)
        data_tests:
          - not_null

      - name: opened_at
        description: Timestamp when the store opened for business
        data_tests:
          - not_null

      - name: tax_rate
        description: Sales tax rate for this store location (decimal)
        data_tests:
          - not_null

      - name: _loaded_at
        description: Timestamp when this record was loaded into staging

  - name: stg_jaffle_shop__supplies
    description: >
      Staging model for supply bill of materials.
      Maps individual supply items (ingredients, packaging) to products.
      One row per supply-product combination.
      Cost has been converted from cents to dollars.
    columns:
      - name: supply_id
        description: Supply item identifier (not unique - same supply can be used for multiple products)
        data_tests:
          - not_null

      - name: supply_name
        description: Supply item name
        data_tests:
          - not_null

      - name: cost
        description: Cost of this supply item in dollars
        data_tests:
          - not_null

      - name: perishable
        description: Boolean flag indicating if supply item is perishable
        data_tests:
          - not_null

      - name: sku
        description: Foreign key to products
        data_tests:
          - not_null
          - relationships:
              to: ref('stg_jaffle_shop__products')
              field: sku

      - name: _loaded_at
        description: Timestamp when this record was loaded into staging
